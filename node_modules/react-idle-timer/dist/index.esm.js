var at=Object.create,ve=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var ut=Object.getPrototypeOf,mt=Object.prototype.hasOwnProperty;var dt=t=>ve(t,"__esModule",{value:!0});var pt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ft=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ct(e))!mt.call(t,r)&&r!=="default"&&ve(t,r,{get:()=>e[r],enumerable:!(n=lt(e,r))||n.enumerable});return t},ht=t=>ft(dt(ve(t!=null?at(ut(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var _e=pt((oe,Ne)=>{(function(t,e){typeof oe=="object"&&typeof Ne!="undefined"?e(oe):typeof define=="function"&&define.amd?define(["exports"],e):(t=typeof globalThis!="undefined"?globalThis:t||self,e(t.fastUniqueNumbers={}))})(oe,function(t){"use strict";var e=function(p){return function(o){var f=p(o);return o.add(f),f}},n=function(p){return function(o,f){return p.set(o,f),f}},r=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,a=536870912,u=a*2,b=function(p,o){return function(f){var L=o.get(f),k=L===void 0?f.size:L<u?L+1:0;if(!f.has(k))return p(f,k);if(f.size<a){for(;f.has(k);)k=Math.floor(Math.random()*u);return p(f,k)}if(f.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;f.has(k);)k=Math.floor(Math.random()*r);return p(f,k)}},U=new WeakMap,Z=n(U),m=b(Z,U),c=e(m);t.addUniqueNumber=c,t.generateUniqueNumber=m,Object.defineProperty(t,"__esModule",{value:!0})})});import vt,{forwardRef as Tt}from"react";function It(t){return Tt(function(n,r){let a={...n};!a.onPrompt&&t.prototype.onPrompt&&(a.onPrompt=()=>{t.prototype.onPrompt()}),!a.onIdle&&t.prototype.onIdle&&(a.onIdle=()=>{t.prototype.onIdle()}),!a.onActive&&t.prototype.onActive&&(a.onActive=b=>{t.prototype.onActive(b)}),!a.onAction&&t.prototype.onAction&&(a.onAction=b=>{t.prototype.onAction(b)});let u=$(a);return typeof r=="function"?r(u):r&&(r.current=u),vt.createElement(t,{...n,...u})})}import{useEffect as F,useRef as h,useCallback as E}from"react";var K=ht(_e());var Fe=t=>t.method!==void 0&&t.method==="call";var Ue=t=>t.error===null&&typeof t.id=="number";var We=t=>{let e=new Map([[0,()=>{}]]),n=new Map([[0,()=>{}]]),r=new Map,a=new Worker(t);return a.addEventListener("message",({data:m})=>{if(Fe(m)){let{params:{timerId:c,timerType:d}}=m;if(d==="interval"){let p=e.get(c);if(typeof p=="number"){let o=r.get(p);if(o===void 0||o.timerId!==c||o.timerType!==d)throw new Error("The timer is in an undefined state.")}else if(typeof p!="undefined")p();else throw new Error("The timer is in an undefined state.")}else if(d==="timeout"){let p=n.get(c);if(typeof p=="number"){let o=r.get(p);if(o===void 0||o.timerId!==c||o.timerType!==d)throw new Error("The timer is in an undefined state.")}else if(typeof p!="undefined")p(),n.delete(c);else throw new Error("The timer is in an undefined state.")}}else if(Ue(m)){let{id:c}=m,d=r.get(c);if(d===void 0)throw new Error("The timer is in an undefined state.");let{timerId:p,timerType:o}=d;r.delete(c),o==="interval"?e.delete(p):n.delete(p)}else{let{error:{message:c}}=m;throw new Error(c)}}),{clearInterval:m=>{let c=(0,K.generateUniqueNumber)(r);r.set(c,{timerId:m,timerType:"interval"}),e.set(m,c),a.postMessage({id:c,method:"clear",params:{timerId:m,timerType:"interval"}})},clearTimeout:m=>{let c=(0,K.generateUniqueNumber)(r);r.set(c,{timerId:m,timerType:"timeout"}),n.set(m,c),a.postMessage({id:c,method:"clear",params:{timerId:m,timerType:"timeout"}})},setInterval:(m,c)=>{let d=(0,K.generateUniqueNumber)(e);return e.set(d,()=>{m(),typeof e.get(d)=="function"&&a.postMessage({id:null,method:"set",params:{delay:c,now:performance.now(),timerId:d,timerType:"interval"}})}),a.postMessage({id:null,method:"set",params:{delay:c,now:performance.now(),timerId:d,timerType:"interval"}}),d},setTimeout:(m,c)=>{let d=(0,K.generateUniqueNumber)(n);return n.set(d,m),a.postMessage({id:null,method:"set",params:{delay:c,now:performance.now(),timerId:d,timerType:"timeout"}}),d}}};var Q=null,Be=(t,e)=>()=>{if(Q!==null)return Q;let n=new Blob([e],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(n);return Q=t(r),Q.setTimeout(()=>URL.revokeObjectURL(r),0),Q};var He=`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`;var ie=Be(We,He),Ge=t=>ie().clearInterval(t),qe=t=>ie().clearTimeout(t),Ve=(t,e)=>ie().setInterval(t,e),je=(t,e)=>ie().setTimeout(t,e);var g=(typeof window=="undefined"?"undefined":typeof window)=="object";var v={setTimeout:g?setTimeout.bind(window):setTimeout,clearTimeout:g?clearTimeout.bind(window):clearTimeout,setInterval:g?setInterval.bind(window):setInterval,clearInterval:g?clearInterval.bind(window):clearInterval},Et={setTimeout:je,clearTimeout:qe,setInterval:Ve,clearInterval:Ge};function bt(){v.setTimeout=setTimeout,v.clearTimeout=clearTimeout,v.setInterval=setInterval,v.clearInterval=clearInterval}function Ye(t){v.setTimeout=t.setTimeout,v.clearTimeout=t.clearTimeout,v.setInterval=t.setInterval,v.clearInterval=t.clearInterval}var j={},Je=class{constructor(e){this.closed=!1;this.mc=new MessageChannel;this.name=e,j[e]=j[e]||[],j[e].push(this),this.mc.port1.start(),this.mc.port2.start(),this.onStorage=this.onStorage.bind(this),window.addEventListener("storage",this.onStorage)}onStorage(e){if(e.storageArea!==window.localStorage||e.key.substring(0,this.name.length)!==this.name||e.newValue===null)return;let n=JSON.parse(e.newValue);this.mc.port2.postMessage(n)}postMessage(e){if(this.closed)throw new Error("InvalidStateError");let n=JSON.stringify(e),r=`${this.name}:${String(Date.now())}${String(Math.random())}`;window.localStorage.setItem(r,n),v.setTimeout(()=>{window.localStorage.removeItem(r)},500),j[this.name].forEach(a=>{a!==this&&a.mc.port2.postMessage(JSON.parse(n))})}close(){if(this.closed)return;this.closed=!0,this.mc.port1.close(),this.mc.port2.close(),window.removeEventListener("storage",this.onStorage);let e=j[this.name].indexOf(this);j[this.name].splice(e,1)}get onmessage(){return this.mc.port1.onmessage}set onmessage(e){this.mc.port1.onmessage=e}get onmessageerror(){return this.mc.port1.onmessageerror}set onmessageerror(e){this.mc.port1.onmessageerror=e}addEventListener(e,n){return this.mc.port1.addEventListener(e,n)}removeEventListener(e,n){return this.mc.port1.removeEventListener(e,n)}dispatchEvent(e){return this.mc.port1.dispatchEvent(e)}},ze=typeof window=="undefined"?void 0:typeof window.BroadcastChannel=="function"?window.BroadcastChannel:Je;function Xe(t=0){return new Promise(e=>v.setTimeout(e,t))}var I=()=>g?performance.now():Date.now();function se(){return I().toString(36).substring(2)}var l;(function(o){o[o.APPLY=0]="APPLY",o[o.TELL=1]="TELL",o[o.CLOSE=2]="CLOSE",o[o.REGISTER=3]="REGISTER",o[o.DEREGISTER=4]="DEREGISTER",o[o.IDLE=5]="IDLE",o[o.ACTIVE=6]="ACTIVE",o[o.PROMPT=7]="PROMPT",o[o.START=8]="START",o[o.RESET=9]="RESET",o[o.PAUSE=10]="PAUSE",o[o.RESUME=11]="RESUME",o[o.MESSAGE=12]="MESSAGE"})(l||(l={}));var Te=class{constructor(e,n){this.token=se();this.isLeader=!1;this.isDead=!1;this.isApplying=!1;this.reApply=!1;this.intervals=[];this.listeners=[];this.channel=e,this.options=n,this.apply=this.apply.bind(this),this.awaitLeadership=this.awaitLeadership.bind(this),this.sendAction=this.sendAction.bind(this)}async apply(){if(this.isLeader||this.isDead)return!1;if(this.isApplying)return this.reApply=!0,!1;this.isApplying=!0;let e=!1,n=r=>{let{token:a,action:u}=r.data;a!==this.token&&(u===l.APPLY&&a>this.token&&(e=!0),u===l.TELL&&(e=!0))};this.channel.addEventListener("message",n);try{return this.sendAction(l.APPLY),await Xe(this.options.responseTime),this.channel.removeEventListener("message",n),this.isApplying=!1,e?this.reApply?this.apply():!1:(this.assumeLead(),!0)}catch{return!1}}awaitLeadership(){if(this.isLeader)return Promise.resolve();let e=!1,n=null;return new Promise(r=>{let a=()=>{if(e)return;e=!0,v.clearInterval(n);let b=this.intervals.indexOf(n);this.intervals.splice(b,1),this.channel.removeEventListener("message",u),r()};n=v.setInterval(()=>{this.apply().then(()=>{this.isLeader&&a()})},this.options.fallbackInterval),this.intervals.push(n);let u=b=>{let{action:U}=b.data;U===l.CLOSE&&this.apply().then(()=>{this.isLeader&&a()})};this.channel.addEventListener("message",u)})}sendAction(e){this.channel.postMessage({action:e,token:this.token})}assumeLead(){this.isLeader=!0;let e=n=>{let{action:r}=n.data;r===l.APPLY&&this.sendAction(l.TELL)};return this.channel.addEventListener("message",e),this.listeners.push(e),this.sendAction(l.TELL)}waitForLeadership(){return this.deferred?this.deferred:(this.deferred=this.awaitLeadership(),this.deferred)}close(){this.isDead||(this.isDead=!0,this.isLeader=!1,this.sendAction(l.CLOSE),this.listeners.forEach(e=>this.channel.removeEventListener("message",e)),this.intervals.forEach(e=>v.clearInterval(e)))}};var P;(function(r){r[r.PROMPTED=0]="PROMPTED",r[r.ACTIVE=1]="ACTIVE",r[r.IDLE=2]="IDLE"})(P||(P={}));var Ie=class{constructor(e){this.token=se();this.registry=new Map;this.allIdle=!1;let{channelName:n}=e;if(this.options=e,this.channel=new ze(n),this.registry.set(this.token,1),e.leaderElection){let r={fallbackInterval:2e3,responseTime:100};this.elector=new Te(this.channel,r),this.elector.waitForLeadership()}this.channel.addEventListener("message",r=>{let{action:a,token:u,data:b}=r.data;switch(a){case l.REGISTER:this.registry.set(u,1);break;case l.DEREGISTER:this.registry.delete(u);break;case l.IDLE:this.idle(u);break;case l.ACTIVE:this.active(u);break;case l.PROMPT:this.prompt(u);break;case l.MESSAGE:this.options.onMessage(b);break;case l.START:this.options.start(!0);break;case l.RESET:this.options.reset(!0);break;case l.PAUSE:this.options.pause(!0);break;case l.RESUME:this.options.resume(!0);break}}),this.send(l.REGISTER)}get isLeader(){if(!this.elector)throw new Error('\u274C Leader election is not enabled. To Enable it set the "leaderElection" property to true.');return this.elector.isLeader}prompt(e=this.token){this.registry.set(e,0);let n=[...this.registry.values()].every(r=>r===0);e===this.token&&this.send(l.PROMPT),n&&this.options.onPrompt()}idle(e=this.token){this.registry.set(e,2);let n=[...this.registry.values()].every(r=>r===2);e===this.token&&this.send(l.IDLE),!this.allIdle&&n&&(this.allIdle=!0,this.options.onIdle())}active(e=this.token){this.registry.set(e,1);let n=[...this.registry.values()].some(r=>r===1);e===this.token&&this.send(l.ACTIVE),this.allIdle&&n&&(this.allIdle=!1,this.options.onActive())}sync(){try{this.channel.postMessage({action:l.RESET,token:this.token})}catch{}}message(e){try{this.channel.postMessage({action:l.MESSAGE,token:this.token,data:e})}catch{}}send(e){try{this.channel.postMessage({action:e,token:this.token})}catch{}}close(){this.options.leaderElection&&this.elector.close(),this.send(l.DEREGISTER),this.channel.close()}};var $e=g?document:null,Ee=["mousemove","keydown","wheel","DOMMouseScroll","mousewheel","mousedown","touchstart","touchmove","MSPointerDown","MSPointerMove","visibilitychange"];import{useRef as gt,useEffect as wt}from"react";function _(t){let e=gt(t);return wt(()=>{e.current=t},[t]),e}function Ke(t,e){let n;function r(...a){n&&clearTimeout(n),n=setTimeout(()=>{t(...a),n=null},e)}return r.cancel=function(){clearTimeout(n)},r}function ae(t,e){let n=0;return function(...r){let a=new Date().getTime();if(!(a-n<e))return n=a,t(...r)}}function $({timeout:t=1e3*60*20,promptTimeout:e=0,element:n=$e,events:r=Ee,timers:a=void 0,immediateEvents:u=[],onPrompt:b=()=>{},onIdle:U=()=>{},onActive:Z=()=>{},onAction:m=()=>{},onMessage:c=()=>{},debounce:d=0,throttle:p=0,eventsThrottle:o=200,startOnMount:f=!0,startManually:L=!1,stopOnIdle:k=!1,crossTab:G=!1,name:be="idle-timer",syncTimers:Y=0,leaderElection:ge=!1}={}){let J=h(I()),we=h(Date.now()),ce=h(I()),A=h(null),O=h(null),z=h(0),T=h(!0),S=h(!1),W=h(!0),X=h(!1),w=h(!1),M=h(0),D=h(0),C=h(null),s=h(null),N=_(t),ee=_(e),Qe=_(k),ye=h(u),ue=h(n),me=h([...new Set([...r,...u]).values()]),Le=_(U),te=_(Z),Me=_(b),re=_(c),y=h();F(()=>{y.current&&y.current.cancel&&y.current.cancel(),d>0?y.current=Ke(m,d):p>0?y.current=ae(m,p):y.current=m},[m,p,d]);let ke=h();F(()=>{G&&Y&&(ke.current=ae(()=>{s.current.sync()},Y))},[G,Y]);let R=()=>{C.current!==null&&(v.clearTimeout(C.current),C.current=null)},q=(i,x=!0)=>{R(),C.current=v.setTimeout(de,i||N.current),x&&(O.current=I())},xe=i=>{M.current=0,D.current=I(),w.current=!0,q(ee.current,!1),Me.current(i)},Pe=()=>{T.current=!0,A.current=I(),Qe.current?(R(),H()):w.current&&(D.current=0,w.current=!1),Le.current()},Se=i=>{w.current=!1,D.current=0,T.current=!1,z.current+=I()-A.current,B(),q(),te.current(i)},de=i=>{if(!T.current){if(y.current.cancel&&y.current.cancel(),ee.current>0&&!w.current){s.current?s.current.prompt():xe(i);return}s.current?s.current.idle():Pe();return}s.current?s.current.active():Se(i)},Re=i=>{if(y.current(i),w.current)return;G&&Y&&ke.current(),R();let x=I()-O.current;if((T.current&&!k||!T.current&&x>N.current)&&de(i),S.current=!1,M.current=0,D.current=0,!T.current&&ye.current.includes(i.type)){de(i);return}q(),s.current&&s.current.active()},ne=h();F(()=>{let i=X.current;i&&H(),o>0?ne.current=ae(Re,o):ne.current=Re,i&&B()},[o,G,Y]);let B=()=>{!g||X.current||(me.current.forEach(i=>{ue.current.addEventListener(i,ne.current,{capture:!0,passive:!0})}),X.current=!0)},H=(i=!1)=>{!g||(X.current||i)&&(me.current.forEach(x=>{ue.current.removeEventListener(x,ne.current,{capture:!0})}),X.current=!1)},V=E(i=>{R(),B(),w.current&&te.current(),T.current=!1,w.current=!1,S.current=!1,M.current=0,D.current=0,s.current&&!i&&(s.current.active(),s.current.send(l.START)),q()},[C,T,N,s]),pe=E(i=>{R(),B(),T.current=!1,w.current=!1,S.current=!1,M.current=0,D.current=0,ce.current=I(),s.current&&(s.current.allIdle=!1,i||s.current.send(l.RESET)),L||q()},[C,T,N,L,s]),fe=E((i=!1)=>S.current?!1:(M.current=Ae(),S.current=!0,H(),R(),s.current&&(i||s.current.send(l.PAUSE)),!0),[C,s]),he=E((i=!1)=>S.current?(S.current=!1,w.current||B(),T.current||q(M.current),D.current&&(D.current=I()),s.current&&(i||s.current.send(l.RESUME)),!0):!1,[C,N,M,s]),Ze=E((i,x)=>{s.current?(x&&re.current(i),s.current.message(i)):x&&re.current(i)},[c]),et=E(()=>T.current,[T]),tt=E(()=>w.current,[w]),rt=E(()=>{if(!s.current)throw new Error('\u274C Cross Tab feature is not enabled. To enable it set the "crossTab" property to true.');return s.current.isLeader},[s]),Ae=E(()=>{if(S.current)return M.current;let i=M.current?M.current:ee.current+N.current,x=O.current?I()-O.current:0,Ce=Math.ceil(i-x);return Ce<0?0:Math.abs(Ce)},[N,ee,w,M,O]),nt=E(()=>Math.round(I()-ce.current),[ce]),Oe=E(()=>Math.round(I()-J.current),[J]),ot=E(()=>A.current?new Date(we.current-J.current+A.current):null,[A]),it=E(()=>O.current?new Date(we.current-J.current+O.current):null,[O]),De=E(()=>T.current?Math.round(I()-A.current+z.current):Math.round(z.current),[A,z]),st=E(()=>{let i=Math.round(Oe()-De());return i>=0?i:0},[J,A,z]);return F(()=>{if(d>0&&p>0)throw new Error("\u274C onAction can either be throttled or debounced, not both.");a&&Ye(a);let i=()=>{s.current&&s.current.close(),y.current.cancel&&y.current.cancel(),R(),H(!0)};return g&&window.addEventListener("beforeunload",i),()=>{g&&window.removeEventListener("beforeunload",i),s.current&&s.current.close(),y.current.cancel&&y.current.cancel(),R(),H(!0)}},[]),F(()=>{s.current&&s.current.close(),G?s.current=new Ie({channelName:be,leaderElection:ge,onPrompt:()=>{xe()},onIdle:()=>{Pe()},onActive:()=>{Se()},onMessage:re.current,start:V,reset:pe,pause:fe,resume:he}):s.current=null},[G,be,ge,Me,Le,te,re,V,pe,fe,he]),F(()=>{R(),H(!0),W.current||(S.current=!0,T.current=!0,M.current=0),!L&&(f?V():B())},[L,f,W]),F(()=>{if(!W.current){let i=[...new Set([...r,...u]).values()];if(H(),me.current=i,ue.current=n,ye.current=u,L)return;f?V():B()}},[n,JSON.stringify(r),JSON.stringify(u),W,L,f]),F(()=>{if(W.current)W.current=!1;else{if(N.current=t,L)return;T.current&&(te.current(),s.current&&s.current.active()),V()}},[t,s,L,W,T]),{message:Ze,start:V,reset:pe,pause:fe,resume:he,isIdle:et,isPrompted:tt,isLeader:rt,getRemainingTime:Ae,getElapsedTime:nt,getTotalElapsedTime:Oe,getLastIdleTime:ot,getLastActiveTime:it,getTotalIdleTime:De,getTotalActiveTime:st}}import yt,{createContext as Lt,useContext as Mt}from"react";var le=Lt(null);function kt(t){let e=$(t);return yt.createElement(le.Provider,{value:e},t.children)}var xt=le.Consumer;function Pt(){return Mt(le)}export{Ee as DEFAULT_EVENTS,xt as IdleTimerConsumer,le as IdleTimerContext,kt as IdleTimerProvider,bt as createMocks,$ as useIdleTimer,Pt as useIdleTimerContext,It as withIdleTimer,Et as workerTimers};
