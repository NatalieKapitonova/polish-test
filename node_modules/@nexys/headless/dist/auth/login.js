import React from "react";
import { Navigate } from "react-router-dom";
import * as Credentials from "./credentials";
import { REDIRECT_URI } from "./conf";
import * as Store from "../store";
import { LoadDataAsync as PreLoadDataAsync } from "../components";
const defaultAppUrl = "/app";
/**
 * after call to backend, login user on the client side
 */
export const RedirectSuccess = ({ profile, permissions, locale, redirectUrl, }) => {
    console.info("User logged in [client]");
    Credentials.set(profile, permissions, locale);
    // if locale different from currently loaded locale, get new one
    // todo
    // get redirect url
    const redirectUrlFinal = redirectUrl || Store.get(REDIRECT_URI) || defaultAppUrl;
    return React.createElement(Navigate, { to: redirectUrlFinal });
};
export const Login = (Spinner) => ({ loginPayload, apiCall, }) => {
    const LoadDataAsync = PreLoadDataAsync(Spinner);
    return (React.createElement(LoadDataAsync, { getData: () => apiCall(loginPayload), Component: ({ data }) => React.createElement(RedirectSuccess, { ...data }) }));
};
